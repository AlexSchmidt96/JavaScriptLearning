<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battleship Arena</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    h1 {
        display: flex;
        justify-content: center;
        padding-bottom: 10px;
    }

    #battleArena {
        padding-top: 30px;
    }

    .messageArea {
        display: flex;
        justify-content: space-evenly;
    }

    table {
        width: 300px;
        height: 300px;
        padding-left: 10px;
        border-collapse: collapse;
    }

    td,
    th {
        width: 30px;
        border: 1px solid black;
        padding: 3px;
        text-align: center;
    }

    th {
        font-weight: bold;
        background-color: #E6E6E6;
    }

    #playerArea .ship {
        background-color: black;
    }

    #enemyArea .ship {
        background-color: red;
    }
</style>

<body>
    <h1>Battleship Arena</h1>
    <div id='battleArena'>
        <div class='messageArea'>
            <table id='playerArea'>
                <thead>
                </thead>
                <tbody>
                </tbody>
            </table>
            <table id='enemyArea'>
                <thead>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        const playerArea = document.getElementById('playerArea')
        const enemyArea = document.getElementById('enemyArea')
        class Ship {
            constructor(coordinates) {
                this.coordinates = coordinates
            }
            isFree(x, y) {
                for (let i = 0; i < this.coordinates.length; i++) {
                    const coordinate = this.coordinates[i]
                    if (
                        (x === coordinate.x && y === coordinate.y) ||
                        (x - 1 === coordinate.x && y === coordinate.y) ||
                        (x === coordinate.x && y - 1 === coordinate.y) ||
                        (x + 1 === coordinate.x && y === coordinate.y) ||
                        (x + 1 === coordinate.x && y - 1 === coordinate.y) ||
                        (x === coordinate.x && y + 1 === coordinate.y) ||
                        (x - 1 === coordinate.x && y - 1 === coordinate.y) ||
                        (x - 1 === coordinate.x && y + 1 === coordinate.y) ||
                        (x + 1 === coordinate.x && y + 1 === coordinate.y)
                    ) {
                        return false
                    }
                }
                return true
            }

        }

        const UP_DIRECTION = 1
        const DOWN_DIRECTION = 2
        const LEFT_DIRECTION = 3
        const RIGHT_DIRECTION = 4


        class BattleshipArea {
            constructor(elem) {
                this.elem = elem
                this.ships = []
                this.sizes = [4, 3, 3, 2, 2, 2, 1, 1, 1, 1]
                this.chars = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J']
            }
            createArea() {
                const chars = this.chars.map((char) => `<th>${char}</th>`).join('')
                const thead = `<tr><th></th>${chars}</tr>`
                let tbody = ''
                for (let y = 1; y <= 10; y++) {
                    let tr = `<th>${y}</th>`
                    for (let x = 1; x <= 10; x++) {
                        tr += `<td class="cell_${x}${y}"></td>`
                    }
                    tbody += `<tr>${tr}</tr>`
                }
                this.elem.querySelector('thead').innerHTML = thead
                this.elem.querySelector('tbody').innerHTML = tbody
            }
            getRandomArbitrary(min, max) {
                min = Math.ceil(min);
                max = Math.floor(max);
                return Math.floor(Math.random() * (max - min + 1)) + min
            }
            insert(size) {
                let x = this.getRandomArbitrary(1, 10)
                let y = this.getRandomArbitrary(1, 10)
                const direction = this.getRandomArbitrary(UP_DIRECTION, RIGHT_DIRECTION)
                const coordinates = []
                try {
                    for (let i = 0; i < size; i++) {
                        console.log(x, y)
                        // проверка на корабль
                        if (!this.canPut(x, y)) {
                            throw new Error('место занято другим кораблем')
                        }
                        // проверка границ
                        if (x > 10 || x < 1 || y > 10 || y < 1) {
                            throw new Error('выход за границу!')
                        }
                        coordinates.push({ x, y })
                        console.log(`часть корабля поставлена на ${x} и ${y} координат `)
                        // проверка сторон
                        switch (direction) {
                            case UP_DIRECTION:
                                y -= 1
                                break
                            case DOWN_DIRECTION:
                                y += 1
                                break
                            case LEFT_DIRECTION:
                                x -= 1
                                break
                            case RIGHT_DIRECTION:
                                x += 1
                                break
                        }
                    }
                    this.ships.push(new Ship(coordinates))
                    console.log('поставил корабль', coordinates.map(({ x, y }) => `${x},${y}`).join(' | '))
                } catch (e) {
                    console.log(e.message)
                    console.log('переставляем')
                    this.insert(size)
                }
            }
            canPut(x, y) {
                for (let i = 0; i < this.ships.length; i++) {
                    const ship = this.ships[i]
                    if (!ship.isFree(x, y)) {
                        return false
                    }
                }
                return true
            }
            generateShips() {
                for (let i = 0; i < this.sizes.length; i++) {
                    this.insert(this.sizes[i])
                }
                this.drawShips()
            }
            drawShips() {
                for (let i = 0; i < this.ships.length; i++) {
                    for (let j = 0; j < this.ships[i].coordinates.length; j++) {
                        const coordinate = this.ships[i].coordinates[j]
                        console.log(coordinate)
                        this.elem.querySelector(`.cell_${coordinate.x}${coordinate.y}`).classList.add("ship")
                    }
                }
            }
        }

        const battleshipPlayerArea = new BattleshipArea(playerArea)
        const battleshipEnemyArea = new BattleshipArea(enemyArea)
        battleshipPlayerArea.createArea()
        battleshipEnemyArea.createArea()
        battleshipPlayerArea.generateShips()
        battleshipEnemyArea.generateShips()



    </script>
    <!--1.Кораблей должно быть 10 
1 корабль — ряд из 4 клеток («четырёхпалубный»; линкор)
2 корабля — ряд из 3 клеток («трёхпалубные»; крейсера)
3 корабля — ряд из 2 клеток («двухпалубные»; эсминцы)
4 корабля — 1 клетка («однопалубные»; торпедные катера)
        2.Они занимают клетки и должны иметь определенную длину , указанную в описании
        3.Корабли должны размещаться рандомно по всему полю
        4.Корабли не должны соприкасаться и наслаиваться друг на друга
        5.Корабли не должны уходить за границы поля и вылезать с противопопложной стороны поля
        6.Должен быть реестр кораблей-->

    <!-- Алгоритм размещения корабля 
        1.Взять корабль из обьекта ships
        2.Поместить на рандомную клетку часть корабля
        3.Начать отступать по длине корабля в разные стороны(сторон всего 4: верх,вниз,влево,вправо) 
        4.Если корабль упирается в границу поля, то прекращаем отступ(меняем место высадки на другую клетку?) и пробуем отступать в другую сторону
        5.Смотрим не задеваем мы другой корабль (коллизия) иначе повторяем шаг 4 
        6.Если все хорошо , то корабль оказывается на поле
        7.Повторить с другими-->

    <!-- { name: 'linkor', size: 4, x: getRandomArbitrary(0, 10), y: getRandomArbitrary(0, 10) }, // реестр с рандомной системой координат
        { name: 'cruiser', size: 3, x: getRandomArbitrary(0, 10), y: getRandomArbitrary(0, 10) },// реестр с рандомной системой координат
        { name: 'cruiser', size: 3, x: getRandomArbitrary(0, 10), y: getRandomArbitrary(0, 10) },// реестр с рандомной системой координат
        { name: 'destroyer', size: 2, x: getRandomArbitrary(0, 10), y: getRandomArbitrary(0, 10) },// реестр с рандомной системой координат
        { name: 'destroyer', size: 2, x: getRandomArbitrary(0, 10), y: getRandomArbitrary(0, 10) },// реестр с рандомной системой координат
        { name: 'destroyer', size: 2, x: getRandomArbitrary(0, 10), y: getRandomArbitrary(0, 10) },// реестр с рандомной системой координат
        { name: 'boat', size: 1, x: getRandomArbitrary(0, 10), y: getRandomArbitrary(0, 10) },// реестр с рандомной системой координат
        { name: 'boat', size: 1, x: getRandomArbitrary(0, 10), y: getRandomArbitrary(0, 10) },// реестр с рандомной системой координат
        { name: 'boat', size: 1, x: getRandomArbitrary(0, 10), y: getRandomArbitrary(0, 10) },// реестр с рандомной системой координат
        { name: 'boat', size: 1, x: getRandomArbitrary(0, 10), y: getRandomArbitrary(0, 10) },// реестр с рандомной системой координат -->

    <!-- let num = getRandomArbitrary(1, 4)
        if (num === 1) {
            obj = { coordinates: [{ xCoor: x + 1 }, { yCoor: y }] }
            ships.push(obj)
        } else if (num === 2) {
            obj = { coordinates: [{ xCoor: x - 1 }, { yCoor: y }] }
            ships.push(obj)
        } else if (num === 3) {
            obj = { coordinates: [{ xCoor: x }, { yCoor: y - 1 }] }
            ships.push(obj)
        } else if (num === 4) {
            obj = { coordinates: [{ xCoor: x }, { yCoor: y + 1 }] }
            ships.push(obj)
        } -->

    <!-- 
        х,у ; check
     х + 1,у ; check
    x,y + 1; check
    x - 1,y; check
    x,y - 1; check
    x - 1 , y - 1; check
    x + 1, y + 1; check
    x + 1 , y - 1; check
    x - 1 , y + 1; check
-->

    <!-- рефакторинг! 
    заоплнить вражеское поле!-->
</body>

</html>